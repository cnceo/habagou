$(document).ready(function(){function a(){if(1==f)var a=$("#djyy").val();else if(f>=2&&f<=4)var a=$("#zyyy").val();if(a){var b=a.split(",");for(i=0;i<b.length;i++)$(".new_gcn ul li:eq("+b[i]+")").append('<span class="click"></span>')}}function b(){$(".new_gcn ul li span.click").remove()}function c(a){a.preventDefault()}$(".new_gc").css("height",$("#page").height()-$(".bottom").height()-$(".new_head").height()-$(".back").height()-100),$(".new_gcn ul li").css("height",236*$(".new_gcn ul li").width()/220),FastClick.attach(document.body),$(".new_gcn ul li label").attr("class","zl_"+$("#zy_zl").val());var d=$("#screen");$(".backLink").on("click",function(){window.location.href="/land/land/home"}),$(".back_span2").on("click",function(){location.reload()}),$(".close8").on("click",function(){$("#infoBox").hide()}),$(".okInfoClose").on("click",function(){$("#okInfo").hide()}),$(".okInfoClose1").on("click",function(){$("#okInfo1").hide()}),$(".close10").on("click",function(){$("#harvest").hide(),unlock(d)}),$(".close12").on("click",function(){$(".zengyang").hide(),unlock(d)}),$(".close12").on("click",function(){$(".weiyang").hide(),unlock(d)}),$(".friendListClose").on("click",function(){$("#friendList").hide(),unlock(d)}),bjui_config.error_report=function(a,b,c,d,e){$("#infoBox").show(),$("#infoBox").find(".infoText").text(d)};var e=$(".new_gc ul").find("li");e.each(function(a){function b(){var a=$(e[d]).find(".left2right");a.attr("src","/res/image/farm/00.gif"),a.stop().animate({left:"60%"},6e3,function(){a.attr("src","/res/image/farm/01.gif"),a.stop().animate({left:"15%"},6e3,function(){b()})})}function c(){var a=$(e[d]).find(".right2left");a.attr("src","/res/image/farm/01.gif"),a.stop().animate({left:"15%"},6e3,function(){a.attr("src","/res/image/farm/00.gif"),a.stop().animate({left:"60%"},6e3,function(){c()})})}var d=a,a=0;b(),c()});var f=1;$(document).on("touchstart",".new_gcn ul li span.li_click",function(a){a.stopPropagation();var b=parseInt($(this).parent("li").index());$(".new_gcn ul li:eq("+b+")").find(".paopao").remove();var c=$("#zyyy").val();if(c){var d=c.split(","),e=0;for(i in d)b==d[i]&&(e=1);e&&BizCall("land.Land.popup",{index:b},function(a){$(".new_gcn ul li:eq("+b+")").find(".totalNumA").text(a.wealth),$(".new_gcn ul li:eq("+b+")").find(".todayNumA").text(a.today),$(".new_gcn ul li:eq("+b+")").find(".oldNumA").text(a.history),$(".new_gcn ul li:eq("+b+")").find(".dogText").toggle(),$(".new_gcn ul li:eq("+b+")").siblings().find(".dogText").hide()})}}),$(document).on("click",".new_gcn ul li span.paopao",function(a){a.stopPropagation(),1==$("#audio").attr("audio-flag")&&$("#audio").get(0).play();var b=parseInt($(this).parent("li").index());BizCall("land.Land.hitPop",{index:b},function(a){$(".new_gcn ul li:eq("+b+")").find(".paopao").remove();var c=parseFloat($(".em1").text()),d=c+parseFloat(a);$(".em1").text(d.toFixed(2));var e=$(".new_gcn ul li:eq("+b+")").find(".jiahao");e.text(parseFloat(a).toFixed(2)).show(),e.animate({top:6,opacity:0},500)})});var g=1;$(".bottom1 span").click(function(){f=$(this).attr("alt"),1==g?(a(),g=0):(b(),g=1)}),$(".mu1").on("click",function(a){a.stopPropagation();var b,c=$(".new_gcn ul").find("li");return c.each(function(a){var d=a;$(c[d]).find(".zengyangOpacity").hide(),$(c[d]).find(".weiyangOpacity").hide(),$(c[d]).find(".shouhuo").hide(),b=$(c[d]).find(".kaigouChang"),b.each(function(a){var b=$(this);"0"==b.attr("data-flag")&&(b.toggle(),b.off(),b.on("click",function(a){a.stopPropagation(),b.hide(),b.attr("data-flag",1),BizCall("land.Land.create",{index:d},function(a){function b(){var a=$(c[d]).find(".left2right");a.attr("src","../../res/image/farm/00.gif"),a.stop().animate({left:"60%"},6e3,function(){a.attr("src","../../res/image/farm/01.gif"),a.stop().animate({left:"15%"},6e3,function(){b()})})}imgHtml='<img id="moveimg" class="left2right" src="../../res/image/farm/00.gif" />',$(c[d]).append(imgHtml),b();var e=$(".dogFarm ul li").find(".kaigouChang");e.each(function(a){$(e[a]).hide()});$(c[d]).append('<div class="zengyangOpacity" zengyang-flag="{{dog}}"></div>');$(c[d]).append('<div class="weiyangOpacity"></div>');$(c[d]).append('<div class="shouhuo"></div>');var f=$("#zyyy").val();f=""!=f?f+","+d:d,$("#zyyy").val(f)})}))})}),!1}),$(".mu2").on("click",function(){var a=$(".new_gcn ul").find("li");a.each(function(b){var c=b;$(a[c]).find(".kaigouChang").hide(),$(a[c]).find(".weiyangOpacity").hide(),$(a[c]).find(".shouhuo").hide();var e=$(a[c]).find(".zengyangOpacity");e.toggle(),e.off(),e.on("click",function(b){b.stopPropagation(),$(".zengyangOpacity").hide(),$(".zengyang").show(),lock(d),BizCall("user.User.addMax",{index:c},function(a){$(".numberAdd").val(a)}),$("#addyang").off(),$("#addyang").on("click",function(b){b.stopPropagation();var e=$(".numberAdd").val();if(""==e)$("#infoBox").show(),$("#infoBox").find(".infoText").text("请输入增养数量");else{/^[0-9]*[1-9][0-9]*$/.test(e)?BizCall("land.Land.addOxygen",{index:c,num:$(".numberAdd").val()},function(b){function e(){var b=$(a[c]).find(".left2right");b.attr("src","../../res/image/farm/00.gif"),b.stop().animate({left:"60%"},6e3,function(){b.attr("src","../../res/image/farm/01.gif"),b.stop().animate({left:"15%"},6e3,function(){e()})})}function f(){var b=$(a[c]).find(".right2left");b.attr("src","../../res/image/farm/01.gif"),b.stop().animate({left:"15%"},6e3,function(){b.attr("src","../../res/image/farm/00.gif"),b.stop().animate({left:"60%"},6e3,function(){f()})})}var g=b,h=$(a[c]).find("img"),i=h.length,j=g-i,k="";1==j?k=1==i?'<img id="moveimg" class="right2left" src="../../res/image/farm/00.gif" />':'<img id="moveimg" class="left2right left2right1" src="../../res/image/farm/00.gif" />':2==j?k='<img id="moveimg" class="left2right left2right1" src="../../res/image/farm/00.gif" /><img id="moveimg" class="right2left" src="../../res/image/farm/01.gif" />':3==j&&(k='<img id="moveimg" class="left2right" src="../../res/image/farm/00.gif" /><img id="moveimg" class="right2left" src="../../res/image/farm/01.gif" /><img id="moveimg" class="left2right left2right1" src="../../res/image/farm/00.gif" />'),$(a[c]).append(k),e(),f(),$(".zengyang").hide(),unlock(d),$("#infoBox").find(".infoText").text("增养成功"),$("#infoBox").show()},function(){}):($("#infoBox").show(),$("#infoBox").find(".infoText").text("增养数量必须为大于0的正整数"))}})})})}),$(".mu3").on("click",function(){var a=$(".new_gc ul").find("li");a.each(function(b){var c=b;$(a[c]).find(".kaigouChang").hide(),$(a[c]).find(".zengyangOpacity").hide(),$(a[c]).find(".shouhuo").hide(),$(a[c]).find(".weiyangOpacity").toggle(),$(a[c]).find(".weiyangOpacity").off(),$(a[c]).find(".weiyangOpacity").on("click",function(b){b.stopPropagation(),$(".weiyangOpacity").hide(),$(".weiyang").show(),lock(d),BizCall("user.User.feedMax",{index:c},function(a){$(".numberFeed").val(a)});var e=$("#weiyangBtn");e.off(),e.on("click",function(b){b.stopPropagation();var e=$(".numberFeed").val();if(""==e)$("#infoBox").show(),$("#infoBox").find(".infoText").text("请输入驯化数量");else{/^[0-9]*[1-9][0-9]*$/.test(e)?BizCall("land.Land.feed",{index:c,num:$(".numberFeed").val()},function(b){function e(){var b=$(a[c]).find(".left2right");b.attr("src","../../res/image/farm/00.gif"),b.stop().animate({left:"60%"},6e3,function(){b.attr("src","../../res/image/farm/01.gif"),b.stop().animate({left:"15%"},6e3,function(){e()})})}function f(){var b=$(a[c]).find(".right2left");b.attr("src","../../res/image/farm/01.gif"),b.stop().animate({left:"15%"},6e3,function(){b.attr("src","../../res/image/farm/00.gif"),b.stop().animate({left:"60%"},6e3,function(){f()})})}var g=b,h=$(a[c]).find("img"),i=h.length,j=g-i,k="";1==j?k=1==i?'<img id="moveimg" class="right2left" src="../../res/image/farm/00.gif" />':'<img id="moveimg" class="left2right left2right1" src="../../res/image/farm/00.gif" />':2==j?k='<img id="moveimg" class="left2right left2right1" src="../../res/image/farm/00.gif" /><img id="moveimg" class="right2left" src="../../res/image/farm/01.gif" />':3==j&&(k='<img id="moveimg" class="left2right" src="../../res/image/farm/00.gif" /><img id="moveimg" class="right2left" src="../../res/image/farm/01.gif" /><img id="moveimg" class="left2right left2right1" src="../../res/image/farm/00.gif" />'),$(a[c]).append(k),e(),f(),$(".weiyang").hide(),unlock(d),$("#infoBox").find(".infoText").text("驯化成功"),$("#infoBox").show();var l=$(".numberFeed").val(),m=$(".em1").text(),n=m-l;$(".em1").text(n.toFixed(2));var o=$(".em2").text(),p=parseFloat(o)+parseInt(l);$(".em2").text(p.toFixed(2))},function(){}):($("#infoBox").show(),$("#infoBox").find(".infoText").text("驯化数量必须为大于0的正整数"))}})})})}),$(".mu4").on("click",function(){var a=$(".new_gc ul").find("li");a.each(function(b){var c=b;$(a[c]).find(".kaigouChang").hide(),$(a[c]).find(".zengyangOpacity").hide(),$(a[c]).find(".weiyangOpacity").hide(),$(a[c]).find(".shouhuo").toggle(),$(a[c]).find(".shouhuo").off(),$(a[c]).find(".shouhuo").on("click",function(b){b.stopPropagation(),$(".shouhuo").hide(),bjui_config.error_report=function(a,b,c,d,e){$("#infoBox").show(),$("#infoBox").find(".infoText").text(d)},BizCall("land.Land.harvest",{index:c},function(b){function e(){var b=$(a[c]).find(".left2right");b.attr("src","/res/image/farm/00.gif"),b.stop().animate({left:"60%"},6e3,function(){b.attr("src","../../res/image/farm/01.gif"),b.stop().animate({left:"15%"},6e3,function(){e()})})}lock(d),$("#harvest").show(),$(".harvestNum").text(b),$(a[c]).find("img").remove();var f="";f='<img id="moveimg" class="left2right" src="/res/image/farm/00.gif" />',$(a[c]).append(f),e()},function(){})})})}),$("#zengyangBtn").on("click",function(){$("#wareHouse").hide(),unlock(d);var a=$(".new_gcn ul").find("li");a.each(function(b){var c=b;$(a[c]).find(".kaigouChang").hide(),$(a[c]).find(".weiyangOpacity").hide(),$(a[c]).find(".shouhuo").hide();var e=$(a[c]).find(".zengyangOpacity");e.toggle(),e.off(),e.on("click",function(b){b.stopPropagation(),$(".zengyangOpacity").hide(),$(".zengyang").show(),lock(d),BizCall("user.User.addMax",{index:c},function(a){$(".numberAdd").val(a)}),$("#addyang").off(),$("#addyang").on("click",function(b){b.stopPropagation();var e=$(".numberAdd").val();if(""==e)$("#infoBox").show(),$("#infoBox").find(".infoText").text("请输入增养数量");else{/^[0-9]*[1-9][0-9]*$/.test(e)?BizCall("land.Land.addOxygen",{index:c,num:$(".numberAdd").val()},function(b){function e(){var b=$(a[c]).find(".left2right");b.attr("src","../../res/image/farm/00.gif"),b.stop().animate({left:"60%"},6e3,function(){b.attr("src","../../res/image/farm/01.gif"),b.stop().animate({left:"15%"},6e3,function(){e()})})}function f(){var b=$(a[c]).find(".right2left");b.attr("src","../../res/image/farm/01.gif"),b.stop().animate({left:"15%"},6e3,function(){b.attr("src","../../res/image/farm/00.gif"),b.stop().animate({left:"60%"},6e3,function(){f()})})}var g=b,h=$(a[c]).find("img"),i=h.length,j=g-i,k="";1==j?k=1==i?'<img id="moveimg" class="right2left" src="../../res/image/farm/00.gif" />':'<img id="moveimg" class="left2right left2right1" src="../../res/image/farm/00.gif" />':2==j?k='<img id="moveimg" class="left2right left2right1" src="../../res/image/farm/00.gif" /><img id="moveimg" class="right2left" src="../../res/image/farm/01.gif" />':3==j&&(k='<img id="moveimg" class="left2right" src="../../res/image/farm/00.gif" /><img id="moveimg" class="right2left" src="../../res/image/farm/01.gif" /><img id="moveimg" class="left2right left2right1" src="../../res/image/farm/00.gif" />'),$(a[c]).append(k),e(),f(),$(".zengyang").hide(),unlock(d),$("#infoBox").find(".infoText").text("增养成功"),$("#infoBox").show()},function(){}):($("#infoBox").show(),$("#infoBox").find(".infoText").text("增养数量必须为大于0的正整数"))}})})})}),$("#wYangBtn").on("click",function(){$("#wareHouse").hide(),unlock(d);var a=$(".new_gc ul").find("li");a.each(function(b){var c=b;$(a[c]).find(".kaigouChang").hide(),$(a[c]).find(".zengyangOpacity").hide(),$(a[c]).find(".shouhuo").hide(),$(a[c]).find(".weiyangOpacity").toggle(),$(a[c]).find(".weiyangOpacity").off(),$(a[c]).find(".weiyangOpacity").on("click",function(b){b.stopPropagation(),$(".weiyangOpacity").hide(),$(".weiyang").show(),lock(d),BizCall("user.User.feedMax",{index:c},function(a){$(".numberFeed").val(a)});var e=$("#weiyangBtn");e.off(),e.on("click",function(b){b.stopPropagation();var e=$(".numberFeed").val();if(""==e)$("#infoBox").show(),$("#infoBox").find(".infoText").text("请输入驯化数量");else{/^[0-9]*[1-9][0-9]*$/.test(e)?BizCall("land.Land.feed",{index:c,num:$(".numberFeed").val()},function(b){function e(){var b=$(a[c]).find(".left2right");b.attr("src","../../res/image/farm/00.gif"),b.stop().animate({left:"60%"},6e3,function(){b.attr("src","../../res/image/farm/01.gif"),b.stop().animate({left:"15%"},6e3,function(){e()})})}function f(){var b=$(a[c]).find(".right2left");b.attr("src","../../res/image/farm/01.gif"),b.stop().animate({left:"15%"},6e3,function(){b.attr("src","../../res/image/farm/00.gif"),b.stop().animate({left:"60%"},6e3,function(){f()})})}var g=b,h=$(a[c]).find("img"),i=h.length,j=g-i,k="";1==j?k=1==i?'<img id="moveimg" class="right2left" src="../../res/image/farm/00.gif" />':'<img id="moveimg" class="left2right left2right1" src="../../res/image/farm/00.gif" />':2==j?k='<img id="moveimg" class="left2right left2right1" src="../../res/image/farm/00.gif" /><img id="moveimg" class="right2left" src="../../res/image/farm/01.gif" />':3==j&&(k='<img id="moveimg" class="left2right" src="../../res/image/farm/00.gif" /><img id="moveimg" class="right2left" src="../../res/image/farm/01.gif" /><img id="moveimg" class="left2right left2right1" src="../../res/image/farm/00.gif" />'),$(a[c]).append(k),e(),f(),$(".weiyang").hide(),unlock(d),$("#infoBox").find(".infoText").text("驯化成功"),$("#infoBox").show();var l=$(".numberFeed").val(),m=$(".em1").text(),n=m-l;$(".em1").text(n.toFixed(2));var o=$(".em2").text(),p=parseFloat(o)+parseInt(l);$(".em2").text(p.toFixed(2))},function(){}):($("#infoBox").show(),$("#infoBox").find(".infoText").text("驯化数量必须为大于0的正整数"))}})})})}),$("#gonggao").on("click",function(){$("#noticeBox").show(),lock(d)});var h=$("#noticeBox ul").find("li");h.each(function(a){var b=a;$(h[b]).find(".top").on("click",function(){$(h[b]).find(".contentBox").toggle()})}),$(".close13").on("click",function(){$("#noticeBox").hide(),unlock(d)}),$("#myFriend").on("click",function(){$("#friendList").show(),lock(d)}),$(".onekeyclean").on("click",function(){BizCall("user.User.superClean",{},function(a){$("#infoBox").show(),$("#infoBox").find(".infoText").text("一键清洗获得"+a+"只狗仔");var b=parseFloat($(".em1").text()),c=b+parseFloat(a);$(".em1").text(c.toFixed(2))})}),$(".yaoqing").on("click",function(){$("#visitFriend").show(),lock(d),$("#friendList").hide()}),$("#visitFriend").on("click",function(){$("#visitFriend").hide(),unlock(d)}),$(".wareHouseClose").on("click",function(){$("#wareHouse").hide(),unlock(d)}),$(".myWareHouse").on("click",function(a){a.stopPropagation(),$("#wareHouse").show(),lock(d),BizCall("user.User.myWarehouse",{},function(a){$("#xiaogoushu").text(a.warehouse),$("#bone").text(a.bone),$("#langanlevel").attr("src","../../res/image/index/face/langan"+a.level+".png"),$("#dengji").text(a.feederlevel);var b=a.day,c=$("#buy");b>0?(c.attr("disabled","true"),c.addClass("btn1"),c.val("剩余"+b+"天")):(c.removeClass("btn1"),c.removeAttr("disabled"),c.on("click",function(b){b.stopPropagation();var e=a.fee;$("#okInfo1").find(".infoxiaoxi1").text("将要花费"+e+"小狗"),$("#okInfo1").show(),$(".okInfoB1").on("click",function(a){a.stopPropagation(),BizCall("user.User.buySuperclean",{},function(a){c.addClass("btn1"),c.val("剩余"+a+"天"),$("#infoBox").show(),$("#infoBox").find(".infoText").text("购买成功"),c.attr("disabled","true"),setTimeout(function(){$("#infoBox").hide(),$("#okInfo1").hide(),$("#wareHouse").hide(),unlock(d)},1e3)})})}))})}),$("#shengji").on("click",function(){BizCall("user.User.loadNextFeeder",{level:$("#dengji").text()},function(a){$("#okInfo").find(".infoxiaoxi").text("将消耗"+a.fee+"只小狗,成功率"+a.showchance+"%,继续吗?"),$("#okInfo").show()})}),$(".okInfoB").on("click",function(a){a.stopPropagation(),$("#okInfo").hide(),BizCall("user.User.upgradeFeeder",{level:$("#dengji").text()},function(a){if(1==a.flag){var b=a.level-1;$("#infoBox").find(".infoText").text("升级成功"),$("#infoBox").show(),$("#drag").removeClass("feederLever"+b).addClass("feederLever"+a.level),setTimeout(function(){$("#infoBox").hide(),$("#wareHouse").hide(),$("#okInfo").hide(),unlock(d)},1e3)}else $("#infoBox").find(".infoText").text("升级失败"),$("#infoBox").show(),setTimeout(function(){$("#infoBox").hide(),$("#wareHouse").hide(),$("#okInfo").hide(),unlock(d)},1e3)})});var j=document.getElementById("drag");if(j){var k,l;j.addEventListener("touchstart",function(a){var b=a.touches[0];k=b.clientX-j.offsetLeft,l=b.clientY-j.offsetTop,document.addEventListener("touchmove",c,!1)},!1),j.addEventListener("touchmove",function(a){var b=a.touches[0],c=b.clientX-k,d=b.clientY-l;c<0?c=0:c>document.documentElement.clientWidth-j.offsetWidth&&(c=document.documentElement.clientWidth-j.offsetWidth),d<0?d=0:d>document.documentElement.clientHeight-j.offsetHeight&&(d=document.documentElement.clientHeight-j.offsetHeight),j.style.left=c+"px",j.style.top=d+"px"},!1),j.addEventListener("touchend",function(){document.removeEventListener("touchmove",c,!1)},!1)}});